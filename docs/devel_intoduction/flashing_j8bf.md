# Прошивка микроконтроллера утилитой j8bf

Здесь описана работа с утилитой j8bf — основным инструментом тулкита VM5277 для обновления прошивки микроконтроллеров через UART-интерфейс.

## Полезные главы:
- [От автора: Концепция и обоснование j8bf](j8bf_concept.md)
- [Прошивка бутлоадера j8bmb](flashing_bootloader.md)

## Автоматические варианты прошивки на базе j8bf

### Прошивка через Maven
Изучите статью [Создание первого проекта](first_project.md) — пункт "Автоматическое создание через Maven-плагин" для ознакомления с процессом создания и сборки проекта.  
После сборки проекта достаточно выполнить команду:
```bash
mvn j8b:run
```
В результате будет запущена утилита j8bf и выполнена прошивка устройства.

### Прошивка в IDE NetBeans
Изучите статью [NetBeans IDE](netbeans.md) — для ознакомления с процессом создания, открытия и сборки проекта.  
После сборки проекта достаточно выбрать действие "Run" на панели действий или в меню проекта.


## Основной способ прошивки консольной утилитой j8bf

### Формат команды:
```bash
j8bf <платформа>:<микроконтроллер> <частота_МГц> <файл_прошивки.hex> [опции]
```

### Основные опции:
* **-S, --serial <устройство>** — указать конкретный последовательный порт (например, /dev/ttyUSB0)
* **-s, --smart** — включить умный режим прошивки (перезаписываются только изменённые страницы hex файла).
* **-e, --encrypted** — указать, что прошивка зашифрована.
* **-F, --flash** — выполнить прошивку.
* **-V, --verify** — проверить прошивку.
* **-R, --reboot** — перезагрузить устройство.
* **-C, --clear-cache** — очистить кэш прошивки для данного устройства.
* **-q, --quiet** — тихий режим (без вывода стандартной информации).
* **-f, --fwversion <номер>** — задать версию прошивки (0–255).
* **-r, --retries <число>** — количество попыток при ошибках (по умолчанию 3).

### Индикаторы прогресса:
* **e/E** — страница стёрта (с первой попытки / после повтора).
* **w/W** — страница записана (с первой попытки / после повтора).
* **i/I** — страница идентична (с первой попытки / после повтора).
* **s** — страница пропущена в умном режиме (кэш совпадает).
* **-** — страница пропущена (нет данных в HEX-файле для этого адреса).

### Пример использования:
```bash
j8bf avr:atmega328p 16.0 Main_cseg.hex -s -S /dev/ttyUSB0 -F -V -R 
```
Эта команда:
* Подключается к ATmega328p, работающему на 16 МГц.
* Использует умный режим прошивки.
* Записывает файл Main_cseg.hex.
* Проверяет записанное содержимое.
* Перезагружает микроконтроллер после успешной прошивки.
* Использует последовательный порт /dev/ttyUSB0.

### Рекомендация использования для первой прошивки:
```bash
j8bf avr:atmega328p 16.0 Main_cseg.hex -s -F -V -R 
```
Утилита выполнит поиск чипа atmega328p платформы avr подключенного через COM порт (в том числе и USB-UART) и при нахождении выполнит прошивку и проверку прошивки Main_cseg.hex в текущем каталоге. А затем перезапустит МК для выполнения новой прошивки.

## Примечания:
* Для работы j8bf требуется установленный бутлоадер VM5277 на целевом устройстве (см. полезные главы в начале главы).
* Умный режим (-s) использует кэширование прошивок в директории var/mcu_caches тулкита.
* При использовании шифрования (-e) умный режим недоступен, запись выполняется для всей Flash исключая бутлоадер.
* Опции -F, -V, -R утилита выполняет в порядке F>V>R

Если вы не указали порт (-S), утилита выполнит автоматический поиск подключенного устройства с бутлоадером VM5277.

[← Назад к прошивке микроконтроллера](flashing.md)  
[← Назад к содержанию](index.md)

