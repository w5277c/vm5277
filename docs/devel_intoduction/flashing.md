# Прошивка микроконтроллера, обзор подходов:

После успешной компиляции проекта J8B вы получаете файл прошивки в формате Intel HEX, в основном он выглядит как `Main_cseg.hex`  
Этот документ поможет вам выбрать оптимальный способ прошивки микроконтроллера в зависимости от ваших задач и доступного оборудования.

Для обновления прошивки микроконтроллеров в проекте VM5277 доступны два основных способа, каждый из которых имеет свои преимущества и области применения.

## Способ 1: Использование стандартных утилит и программаторов

Этот подход использует уже существующие утилиты для прошивки микроконтроллеров различных платформ.  
VM5277 генерирует стандартные HEX-файлы в формате Intel HEX, которые совместимы с большинством распространенных программаторов.

### Преимущества:
*   Работает с любым МК без предварительной подготовки.
*   Использует проверенные и надежные инструменты.
*   Не требует установки дополнительного ПО на МК.
*   Подходит для первого программирования новых устройств.
*	Стандарт для серийного производства.

### Недостатки:
*   Требует внешний программатор (один из самых простых и доступных - USBasp).
*   Требует подключения к МК через многопиновый порт (занимает несколько пинов МК)
*   Процесс прошивки обычно медленнее и сложнее.
*	Сложный или невозможный процесс интерактивной отладки программы МК.
*	Поддержка одной платформы МК (утилита работает только с конкретным семейством).
*	Ограниченная поддержка мультиплатформенности инструментария

### Требования:
*   Внешний программатор (ISP для AVR, ST-Link для STM8, PICKit для PIC).
*	Соответствующая утилита для работы с программатором (avrdude, stm8flash, pk2cmd).
*   Физический доступ через многопиновый разъем МК для подключения программатора.

### Примеры утилит для прошивки:

*	Среда разработки Microchip Studio for AVR
*	Множественные графические обертки для avrdude
*	Консольный вариант:
```bash
avrdude -p atmega328p -c usbasp -P /dev/ttyUSB0 -U flash:w:Main_cseg.hex:i
avrdude -p atmega328p -c arduino -P /dev/ttyACM0 -b 19200 -U flash:w:Main_cseg.hex
```
*Примечание: Для использования этих утилит требуется их предварительная установка и настройка на вашей системе.*

## Способ 2: Утилита j8bf (flasher) тулкита VM5277

Этот подход использует специализированную утилиту j8bf, входящую в состав тулкита VM5277.  
Она предоставляет упрощенный интерфейс для обновления прошивки через UART (всего 1 пин МК).

### Преимущества:
*	**Мультиплатформенная поддержка микроконтроллеров** - благодаря бутлоадеру утилита может прошивать любое поддерживаемое семейство микроконтроллеров.
*	**Мультиплатформенные утилиты** - все утилиты реализованы на Java и в большинстве случаев будут работать на любом устройстве с поддержкой JavaSE.
*	**Умная прошивка** - записывает только измененные страницы, значительно ускоряя процесс.
*	**Быстрая прошивка** - благодаря комплексу мер запись прошивки занимает меньше времени (а в некоторых случаях существенно меньше), чем стандартные решения.
*	**Не требует внешнего программатора** после установки бутлоадера.
*	**Минимальное подключение** - использует 1 пин МК, а в некоторых моделях использует пин RESET.
*	**Техническая возможность отладки J8B** - заложена техническая возможность (реализация в планах).
*	**Безопасность** - поддержка работы с зашифрованной прошивкой.
*	**Идентификация** - наличие уникального идентификатора чипа (UID).
*	**Системная информация** - встроенная информация о версии прошивки, бутлоадера и т.д.

### Недостатки:
*	Требует наличие **UART интерфейса** (подойдет распространенный и недорогой USB-UART адаптер).
*	Требует **установленного бутлоадера** на МК.
*	**Бутлоадер занимает дополнительную память** на МК (512-1024 байта в конце Flash).

### Требования:
*	Установленный **тулкит VM5277** - основной набор инструментов компиляции и прошивки.
*	Установленный **бутлоадер VM5277** - специальная прошивка, занимающая 512-1024 байт памяти МК.
*	**UART соединение** - подключение МК к компьютеру через USB-UART адаптер.

### Примеры использования:
*   **Среда разработки NetBeans с плагином VM5277** (J8B Language Support)
*	**Maven проект**, консоль:
```bash
mvn j8b:run
```
*	**Консоль**:
```bash
j8bf avr:atmega328p 16.0 Main_cseg.hex -F -V -R
```


## Сравнительная таблица

| Критерий | Стандартные утилиты | Тулкит VM5277 |
|----------|-------------------|-------------------|
| **Необходимое оборудование** | $$ Внешний программатор | $ USB-UART адаптер |
| **Количество пинов** | ~6 (SPI/ISP) | 1 (RESET пин или любой GPIO) + общий GND |
| **Первоначальная настройка** | Не требуется | Требуется однократная установка бутлоадера |
| **Скорость прошивки** | Стандартная | Быстрая |
| **Smart поддержка** | Проверка на МК | Более быстрая проверка на PC |
| **Поддержка платформ** | Одна утилита - одна платформа | Одна утилита - все платформы |
| **Используемая память Flash** | 0-2048 байт | 512-1024 байт |
| **Серийное производство** | Идеально | Требует доработки |
| **Обновление ПО в поле** | Сложно (требует программатор) | Просто (через 1 пин UART) |
| **Безопасность** | Часто отсутсвует | Возможность шифровать прошивку | 
| **Уникальность устройств** |	Часто отсутсвует | Уникальные UID на каждом МК |
| **Кроссплатформенность утилит** |	Частичная (иногда только Windows) | Полная (Java) |
| **Логирование** | Кастомное решение | Встроенное, использует порт прошивки |
| **Отладка** | Базовая, часто отсутствует | Высокоуровневая J8B (в планах) |

## Какой способ выбрать?

### Выберите стандартные утилиты, если:
* Это ваш первый опыт с данным семейством МК
* У вас нет возможности установить бутлоадер (например нет необходимого свободного объема Flash)
* Вы выполняете серийное производство и решили вопрос или не нуждаетесь в уникальной идентифкации устройств.

### Выберите j8bf, если:
* Вы находитесь в фазе активной разработки
* Цените скорость и удобство
* Работаете с несколькими типами МК
* Готовы выделить немного памяти под бутлоадер


## Подробные инструкции
[Прошивка стандартными утилитами](flashing_external.md)  
[Прошивка утилитой j8bf](flashing_j8bf.md)

[← Назад к содержанию](index.md)
